
ðŸ“ŒðŸ“ŒðŸ“ŒðŸ“ŒðŸ“Œ THIS FILES INCLUDES WHAT EACH API ROUTE FOR THE PDFs GENRATION DO, HOW THEY DO, WHY THEY DO ðŸ“ŒðŸ“ŒðŸ“ŒðŸ“ŒðŸ“Œ

=========INVOICE PDF ROUTES=========

âœ… ROUTE : "/invoice/get_pdf" :
WHAT IT DOES : 
This API Generates a PDF for the current userâ€™s invoice, uploads that PDF to S3, updates the invoice record with the S3 URL, and returns the invoice data plus local and S3 paths.

WORKING :
Inputs / parameters : 
current_user (injected via Depends(get_current_user)):
Provided by your authentication dependency.
Expected to be a dict-like user object with "_id" (e.g. ObjectId or string).
No query/body parameters in the route itself â€” everything comes from current_user.

QUICK STEP BY STEP FLOW : 
Read cust_id from current_user["_id"] and convert to str.
Call generate_invoice_pdf_local(cust_id) â€” creates the invoice object and writes a local PDF file; returns { "invoice": {...}, "pdf_path": "/path/to/file.pdf" }.
Extract local filename with os.path.basename(pdf_path).
Call upload_pdf_to_s3(pdf_filename) â€” uploads the local file to S3 and returns the public or presigned URL (s3_url).
Update the invoice record in MongoDB (invoices_collection.update_one) to set pdf_url to the s3_url.
Return a JSON response with a success message, invoice data, local path, and S3 URL.


âœ… services/pdf_service.py :
THIS FILE HAS THE ACTUAL CODE WHICH GENRATES THE PDF :
In shot summary : 
This pdf_service.py module fetches an invoice for a given customer from MongoDB, renders an HTML invoice template with that data (Jinja2), converts the rendered HTML to a PDF (xhtml2pdf / pisa), saves the PDF to a local folder (app/PDFs/), and returns the invoice data plus the local file path. The PDF conversion (blocking) is run on a thread pool so it doesnâ€™t block the asyncio event loop.

